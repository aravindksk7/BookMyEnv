<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookMyEnv - Security Guide</title>
    <style>
        :root {
            --primary: #1976d2;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-800: #424242;
            --gray-900: #212121;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: white;
            color: var(--gray-900);
            line-height: 1.7;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        h1 { color: var(--primary); border-bottom: 3px solid var(--primary); padding-bottom: 10px; margin-bottom: 30px; }
        h2 { color: var(--gray-800); margin: 30px 0 15px; padding-bottom: 8px; border-bottom: 1px solid var(--gray-200); }
        h3 { color: var(--gray-800); margin: 20px 0 10px; }
        
        p { margin: 10px 0; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }
        
        th, td {
            border: 1px solid var(--gray-200);
            padding: 10px 12px;
            text-align: left;
        }
        
        th { background: var(--gray-100); font-weight: 600; }
        tr:nth-child(even) { background: var(--gray-50); }
        
        code {
            background: var(--gray-100);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
        }
        
        pre {
            background: var(--gray-900);
            color: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        pre code { background: none; padding: 0; color: inherit; }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .alert-warning {
            background: #fff3e0;
            border-left: 4px solid var(--warning);
        }
        
        .alert-danger {
            background: #ffebee;
            border-left: 4px solid var(--error);
        }
        
        .alert-success {
            background: #e8f5e9;
            border-left: 4px solid var(--success);
        }
        
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-critical { background: #f44336; color: white; }
        .badge-high { background: #ff9800; color: white; }
        .badge-medium { background: #2196f3; color: white; }
        .badge-low { background: #4caf50; color: white; }
        
        ul, ol { margin: 10px 0 10px 25px; }
        li { margin: 5px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîí BookMyEnv Security Guide</h1>
        
        <p>This document describes the security measures implemented in BookMyEnv and recommendations for production deployment.</p>
        
        <h2>Security Features Implemented</h2>
        
        <h3>1. Authentication & Authorization</h3>
        
        <h4>Password Security</h4>
        <ul>
            <li><strong>Bcrypt hashing</strong> with 12 rounds (OWASP recommended)</li>
            <li><strong>Password strength validation</strong>: Minimum 8 characters with uppercase, lowercase, number, and special character</li>
            <li>Passwords are never logged or exposed in API responses</li>
        </ul>
        
        <h4>JWT Token Security</h4>
        <ul>
            <li>Tokens are signed with a secret key (must be set via environment variable)</li>
            <li>Default expiration: 24 hours</li>
            <li>User role embedded in token for authorization</li>
        </ul>
        
        <h4>Rate Limiting</h4>
        <ul>
            <li><strong>General API</strong>: 100 requests per 15 minutes per IP</li>
            <li><strong>Authentication endpoints</strong>: 5 login attempts per 15 minutes per IP</li>
            <li>Protects against brute force and credential stuffing attacks</li>
        </ul>
        
        <h3>2. Input Validation</h3>
        <ul>
            <li><strong>express-validator</strong> middleware for all user inputs</li>
            <li>Email normalization and validation</li>
            <li>Username alphanumeric validation (3-50 characters)</li>
            <li>Request body size limited to 10KB (DoS protection)</li>
        </ul>
        
        <h3>3. HTTP Security Headers</h3>
        
        <table>
            <tr><th>Header</th><th>Value</th><th>Purpose</th></tr>
            <tr><td>X-Frame-Options</td><td>SAMEORIGIN</td><td>Clickjacking protection</td></tr>
            <tr><td>X-Content-Type-Options</td><td>nosniff</td><td>MIME sniffing protection</td></tr>
            <tr><td>X-XSS-Protection</td><td>1; mode=block</td><td>XSS filter</td></tr>
            <tr><td>Strict-Transport-Security</td><td>max-age=31536000; includeSubDomains; preload</td><td>Force HTTPS</td></tr>
            <tr><td>Referrer-Policy</td><td>strict-origin-when-cross-origin</td><td>Referrer leakage protection</td></tr>
            <tr><td>Content-Security-Policy</td><td>Restrictive policy</td><td>XSS/injection protection</td></tr>
            <tr><td>Permissions-Policy</td><td>Disabled features</td><td>Feature policy</td></tr>
        </table>
        
        <h3>4. Network Security</h3>
        <ul>
            <li>Database NOT exposed externally (internal Docker network only)</li>
            <li>All external traffic via Nginx reverse proxy</li>
            <li>SSL/TLS encryption for all connections</li>
            <li>TLS 1.2 and 1.3 only (weak protocols disabled)</li>
        </ul>
        
        <h2>Production Deployment Checklist</h2>
        
        <h3>Required Environment Variables</h3>
        
        <div class="alert alert-warning">
            <strong>‚ö†Ô∏è Important:</strong> Create a <code>.env</code> file with secure values. Never commit this file to version control!
        </div>
        
        <pre><code># Database (use strong passwords!)
POSTGRES_USER=your_db_user
POSTGRES_PASSWORD=&lt;GENERATE_SECURE_PASSWORD_32_CHARS&gt;
POSTGRES_DB=bookmyenv_prod

# JWT Secret (CRITICAL - use crypto random!)
# Generate with: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
JWT_SECRET=&lt;64_CHAR_RANDOM_HEX_STRING&gt;

# Application
NODE_ENV=production

# URLs (replace with your domain)
CORS_ORIGIN=https://yourdomain.com
FRONTEND_URL=https://yourdomain.com</code></pre>
        
        <h3>SSL Certificates</h3>
        <p>For production, replace self-signed certificates with proper certificates:</p>
        <ul>
            <li><strong>Let's Encrypt (free)</strong>: Use certbot for automatic certificate renewal</li>
            <li><strong>Commercial certificates</strong>: Place certificate files in <code>nginx/ssl/</code></li>
        </ul>
        
        <h2>Demo Credentials</h2>
        
        <div class="alert alert-danger">
            <strong>‚ö†Ô∏è WARNING:</strong> Change all demo passwords in production!
        </div>
        
        <table>
            <tr><th>User</th><th>Email</th><th>Password</th><th>Role</th></tr>
            <tr><td>Admin</td><td>admin@bme.local</td><td>Admin@123</td><td>Admin</td></tr>
            <tr><td>Manager</td><td>envmgr@bme.local</td><td>Admin@123</td><td>EnvironmentManager</td></tr>
            <tr><td>Lead</td><td>lead@bme.local</td><td>Admin@123</td><td>ProjectLead</td></tr>
            <tr><td>Tester</td><td>tester@bme.local</td><td>Admin@123</td><td>Tester</td></tr>
            <tr><td>Viewer</td><td>viewer@bme.local</td><td>Admin@123</td><td>Viewer</td></tr>
        </table>
        
        <h2>Security Vulnerabilities Fixed</h2>
        
        <table>
            <tr><th>Vulnerability</th><th>Severity</th><th>Fix Applied</th></tr>
            <tr><td>Demo password bypass</td><td><span class="badge badge-critical">Critical</span></td><td>Removed - bcrypt only</td></tr>
            <tr><td>Hardcoded JWT secret</td><td><span class="badge badge-critical">Critical</span></td><td>Environment variable required</td></tr>
            <tr><td>Open database port</td><td><span class="badge badge-high">High</span></td><td>Removed external port mapping</td></tr>
            <tr><td>Missing rate limiting</td><td><span class="badge badge-high">High</span></td><td>Implemented on auth endpoints</td></tr>
            <tr><td>No password validation</td><td><span class="badge badge-high">High</span></td><td>Added strength requirements</td></tr>
            <tr><td>Role injection on register</td><td><span class="badge badge-high">High</span></td><td>Role forced to 'Tester'</td></tr>
            <tr><td>Missing input validation</td><td><span class="badge badge-high">High</span></td><td>Added express-validator</td></tr>
            <tr><td>No request size limit</td><td><span class="badge badge-medium">Medium</span></td><td>Limited to 10KB</td></tr>
            <tr><td>Missing CSP header</td><td><span class="badge badge-medium">Medium</span></td><td>Added comprehensive policy</td></tr>
            <tr><td>Missing Permissions-Policy</td><td><span class="badge badge-low">Low</span></td><td>Added to nginx</td></tr>
            <tr><td>Low bcrypt rounds</td><td><span class="badge badge-low">Low</span></td><td>Increased to 12</td></tr>
        </table>
        
        <h2>Additional Resources</h2>
        <ul>
            <li><a href="https://owasp.org/www-project-web-security-testing-guide/">OWASP Security Guidelines</a></li>
            <li><a href="https://nodejs.org/en/docs/guides/security/">Node.js Security Best Practices</a></li>
            <li><a href="https://docs.docker.com/engine/security/">Docker Security</a></li>
        </ul>
        
        <div class="alert alert-success">
            <strong>‚úÖ Security Status:</strong> All 24 functional tests pass with security features enabled.
        </div>
    </div>
</body>
</html>
