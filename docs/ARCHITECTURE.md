# BookMyEnv - Architecture Documentation

## System Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              BOOKMYENV ARCHITECTURE                              │
└─────────────────────────────────────────────────────────────────────────────────┘

                                    ┌─────────────┐
                                    │   Users     │
                                    │  (Browser)  │
                                    └──────┬──────┘
                                           │
                                           │ HTTPS (Port 443)
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              REVERSE PROXY LAYER                                 │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                         NGINX REVERSE PROXY                                │  │
│  │                           (tem-nginx)                                      │  │
│  │                                                                           │  │
│  │  • SSL/TLS Termination (TLS 1.2/1.3)                                     │  │
│  │  • Security Headers (CSP, HSTS, X-Frame-Options)                         │  │
│  │  • Request Routing (/api → backend, / → frontend)                        │  │
│  │  • WebSocket Proxying (/socket.io)                                       │  │
│  │  • Gzip Compression                                                       │  │
│  │                                                                           │  │
│  │  Tech: Nginx Alpine │ Let's Encrypt Ready │ HTTP/2                       │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────┘
                                           │
                              Internal Docker Network
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              PRESENTATION LAYER                                  │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                         NEXT.JS FRONTEND                                   │  │
│  │                         (tem-frontend)                                     │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │  │
│  │  │  Dashboard  │  │ Environments│  │  Bookings   │  │  Releases   │      │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘      │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │  │
│  │  │Applications │  │   Groups    │  │ Monitoring  │  │  Settings   │      │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘      │  │
│  │                                                                           │  │
│  │  Tech: React 18 │ Next.js 14 │ MUI │ TypeScript │ Tailwind CSS           │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────┘
                                           │
                                           │ Internal REST API (Port 5000)
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                               APPLICATION LAYER                                  │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                       EXPRESS.JS BACKEND                                   │  │
│  │                        (tem-backend)                                       │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                         MIDDLEWARE                                   │  │  │
│  │  │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │  │  │
│  │  │ │   Auth   │ │   CORS   │ │  Helmet  │ │   RBAC   │ │   Rate   │  │  │  │
│  │  │ │   JWT    │ │          │ │ Security │ │          │ │  Limit   │  │  │  │
│  │  │ └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘  │  │  │
│  │  └─────────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                          ROUTES                                      │  │  │
│  │  │  /auth  /environments  /bookings  /releases  /applications          │  │  │
│  │  │  /groups  /users  /integrations  /changes  /dashboard               │  │  │
│  │  └─────────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                       CONTROLLERS                                    │  │  │
│  │  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐       │  │  │
│  │  │  │    Auth    │ │Environment │ │  Booking   │ │  Release   │       │  │  │
│  │  │  └────────────┘ └────────────┘ └────────────┘ └────────────┘       │  │  │
│  │  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐       │  │  │
│  │  │  │Application │ │   Group    │ │    User    │ │Integration │       │  │  │
│  │  │  └────────────┘ └────────────┘ └────────────┘ └────────────┘       │  │  │
│  │  └─────────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                           │  │
│  │  Tech: Node.js 22 │ Express.js │ JWT │ bcrypt │ express-validator        │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────┘
                                           │
                                           │ SQL (Internal Network Only)
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                 DATA LAYER                                       │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │                       POSTGRESQL DATABASE                                  │  │
│  │                         (tem-postgres)                                     │  │
│  │                                                                           │  │
│  │  ┌─────────────────────────────────────────────────────────────────────┐  │  │
│  │  │                     CORE ENTITIES (30+)                              │  │  │
│  │  │                                                                      │  │  │
│  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐     │  │  │
│  │  │  │ User & Identity │  │  Environments   │  │  Applications   │     │  │  │
│  │  │  │  • users        │  │  • environments │  │  • applications │     │  │  │
│  │  │  │  • user_groups  │  │  • env_instances│  │  • app_components│    │  │  │
│  │  │  │  • memberships  │  │  • infra_comps  │  │  • comp_instances│    │  │  │
│  │  │  │  • identities   │  │  • interfaces   │  │  • app_env_inst │     │  │  │
│  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘     │  │  │
│  │  │                                                                      │  │  │
│  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐     │  │  │
│  │  │  │    Bookings     │  │    Releases     │  │  Integrations   │     │  │  │
│  │  │  │  • bookings     │  │  • releases     │  │  • integrations │     │  │  │
│  │  │  │  • resources    │  │  • rel_apps     │  │  • int_links    │     │  │  │
│  │  │  │  • applications │  │  • rel_envs     │  │  • jira_mapping │     │  │  │
│  │  │  │                 │  │  • changes      │  │  • gitlab_map   │     │  │  │
│  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘     │  │  │
│  │  └─────────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                           │  │
│  │  Tech: PostgreSQL 15 │ UUID Primary Keys │ JSONB │ Timestamps            │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────┐
│                           EXTERNAL INTEGRATIONS                                  │
│                                                                                  │
│   ┌──────────────┐      ┌──────────────┐      ┌──────────────┐                 │
│   │     JIRA     │      │    GITLAB    │      │  SERVICENOW  │                 │
│   │              │      │              │      │              │                 │
│   │ • Issues     │      │ • Pipelines  │      │ • Changes    │                 │
│   │ • Projects   │      │ • MRs        │      │ • CMDB       │                 │
│   │ • Releases   │      │ • Tags       │      │ • Approvals  │                 │
│   └──────────────┘      └──────────────┘      └──────────────┘                 │
│          ▲                     ▲                     ▲                          │
│          │                     │                     │                          │
│          └─────────────────────┼─────────────────────┘                          │
│                                │                                                 │
│                         REST API / Webhooks                                      │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## Container Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            DOCKER COMPOSE NETWORK                                │
│                              (tem-network)                                       │
│                                                                                  │
│  ┌─────────────────────┐                                                        │
│  │   tem-nginx         │◄─────── Port 443 (HTTPS) ──────► Browser               │
│  │   (Nginx Alpine)    │◄─────── Port 80 (→ 443 redirect)                       │
│  │                     │                                                        │
│  │   • SSL Termination │                                                        │
│  │   • Security Headers│                                                        │
│  │   • Request Routing │                                                        │
│  └──────────┬──────────┘                                                        │
│             │                                                                    │
│             │ Internal Network                                                   │
│             ▼                                                                    │
│  ┌─────────────────────┐                                                        │
│  │   tem-frontend      │◄─────── Internal Port 3000                             │
│  │   (Next.js)         │                                                        │
│  │   Node 22 Alpine    │                                                        │
│  └──────────┬──────────┘                                                        │
│             │                                                                    │
│             │ Internal Network                                                   │
│             ▼                                                                    │
│  ┌─────────────────────┐                                                        │
│  │   tem-backend       │◄─────── Internal Port 5000                             │
│  │   (Express.js)      │                                                        │
│  │   Node 22 Alpine    │                                                        │
│  │                     │                                                        │
│  │   Security Features:│                                                        │
│  │   • Rate Limiting   │                                                        │
│  │   • Input Validation│                                                        │
│  │   • JWT Auth        │                                                        │
│  └──────────┬──────────┘                                                        │
│             │                                                                    │
│             │ Internal Network ONLY (No external port)                          │
│             ▼                                                                    │
│  ┌─────────────────────┐                                                        │
│  │   tem-postgres      │                                                        │
│  │   (PostgreSQL 15)   │                                                        │
│  │   Alpine            │                                                        │
│  │                     │                                                        │
│  │   Volume:           │                                                        │
│  │   postgres_data     │                                                        │
│  └─────────────────────┘                                                        │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## Data Model (Entity Relationship)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ENTITY RELATIONSHIPS                                │
└─────────────────────────────────────────────────────────────────────────────────┘

                          USER & IDENTITY DOMAIN
    ┌───────────────────────────────────────────────────────────────┐
    │                                                               │
    │  ┌──────────┐     ┌──────────────────┐     ┌──────────────┐  │
    │  │  users   │────<│user_group_members│>────│ user_groups  │  │
    │  └────┬─────┘     └──────────────────┘     └──────────────┘  │
    │       │                                                       │
    │       │           ┌──────────────────┐                       │
    │       └──────────<│ user_identities  │                       │
    │                   └────────┬─────────┘                       │
    │                            │                                  │
    │                   ┌────────▼─────────┐                       │
    │                   │identity_providers│                       │
    │                   └──────────────────┘                       │
    └───────────────────────────────────────────────────────────────┘

                         ENVIRONMENT DOMAIN
    ┌───────────────────────────────────────────────────────────────┐
    │                                                               │
    │  ┌──────────────┐     ┌────────────────────┐                 │
    │  │ environments │────<│environment_instances│                 │
    │  └──────────────┘     └─────────┬──────────┘                 │
    │                                 │                             │
    │                    ┌────────────┼────────────┐               │
    │                    ▼            ▼            ▼               │
    │           ┌────────────┐ ┌──────────┐ ┌────────────────┐    │
    │           │infra_comps │ │interfaces│ │app_env_instance│    │
    │           └────────────┘ └────┬─────┘ └────────────────┘    │
    │                               │                              │
    │                    ┌──────────▼──────────┐                   │
    │                    │interface_endpoints  │                   │
    │                    └─────────────────────┘                   │
    └───────────────────────────────────────────────────────────────┘

                          APPLICATION DOMAIN
    ┌───────────────────────────────────────────────────────────────┐
    │                                                               │
    │  ┌──────────────┐     ┌────────────────┐                     │
    │  │ applications │────<│ app_components │                     │
    │  └──────────────┘     └───────┬────────┘                     │
    │                               │                               │
    │                    ┌──────────▼──────────┐                   │
    │                    │component_instances  │                   │
    │                    └─────────────────────┘                   │
    └───────────────────────────────────────────────────────────────┘

                            BOOKING DOMAIN
    ┌───────────────────────────────────────────────────────────────┐
    │                                                               │
    │  ┌────────────────────┐                                      │
    │  │environment_bookings│                                      │
    │  └─────────┬──────────┘                                      │
    │            │                                                  │
    │     ┌──────┴──────┐                                          │
    │     ▼             ▼                                          │
    │ ┌─────────────┐ ┌───────────────────┐                       │
    │ │booking_     │ │booking_applications│                       │
    │ │resources    │ └───────────────────┘                       │
    │ └─────────────┘                                              │
    └───────────────────────────────────────────────────────────────┘

                            RELEASE DOMAIN
    ┌───────────────────────────────────────────────────────────────┐
    │                                                               │
    │  ┌──────────┐                                                │
    │  │ releases │                                                │
    │  └────┬─────┘                                                │
    │       │                                                       │
    │  ┌────┴────────────────────────┐                             │
    │  ▼            ▼                ▼                             │
    │ ┌────────┐ ┌────────────────┐ ┌────────────────────────┐    │
    │ │release_│ │release_        │ │release_component_      │    │
    │ │apps    │ │environments    │ │instances               │    │
    │ └────────┘ └────────────────┘ └────────────────────────┘    │
    │                                                               │
    │  ┌─────────┐                                                 │
    │  │ changes │ (linked to releases)                            │
    │  └─────────┘                                                 │
    └───────────────────────────────────────────────────────────────┘
```

---

## Request Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              REQUEST FLOW                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

   User Action                API Request              Database Query
  ┌──────────┐              ┌───────────┐              ┌──────────┐
  │  Browser │              │  Backend  │              │ PostgreSQL│
  └────┬─────┘              └─────┬─────┘              └────┬─────┘
       │                          │                         │
       │  1. Click "Create       │                         │
       │     Booking"            │                         │
       │                          │                         │
       │  2. Fill form &         │                         │
       │     Submit              │                         │
       │                          │                         │
       │  ─────────────────────► │                         │
       │  POST /api/bookings     │                         │
       │  Authorization: Bearer  │                         │
       │  {booking data}         │                         │
       │                          │                         │
       │                          │  3. Validate JWT       │
       │                          │  4. Check RBAC         │
       │                          │  5. Validate data      │
       │                          │                         │
       │                          │  ─────────────────────►│
       │                          │  INSERT INTO           │
       │                          │  environment_bookings  │
       │                          │                         │
       │                          │  6. Check conflicts    │
       │                          │  ─────────────────────►│
       │                          │  SELECT FROM bookings  │
       │                          │  WHERE overlapping     │
       │                          │                         │
       │                          │  ◄─────────────────────│
       │                          │  Return conflicts      │
       │                          │                         │
       │                          │  ◄─────────────────────│
       │                          │  Return booking_id     │
       │                          │                         │
       │  ◄───────────────────── │                         │
       │  201 Created            │                         │
       │  {booking details}      │                         │
       │                          │                         │
       │  7. Update UI           │                         │
       │                          │                         │
       ▼                          ▼                         ▼
```

---

## Authentication Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AUTHENTICATION FLOW                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

                         LOCAL AUTHENTICATION
    ┌─────────────────────────────────────────────────────────────────┐
    │                                                                 │
    │  ┌────────┐         ┌─────────┐         ┌──────────┐          │
    │  │ Client │         │ Backend │         │ Database │          │
    │  └───┬────┘         └────┬────┘         └────┬─────┘          │
    │      │                   │                   │                 │
    │      │ POST /auth/login  │                   │                 │
    │      │ {email, password} │                   │                 │
    │      │──────────────────►│                   │                 │
    │      │                   │                   │                 │
    │      │                   │ SELECT user       │                 │
    │      │                   │──────────────────►│                 │
    │      │                   │                   │                 │
    │      │                   │◄──────────────────│                 │
    │      │                   │ user record       │                 │
    │      │                   │                   │                 │
    │      │                   │ Verify bcrypt     │                 │
    │      │                   │ hash              │                 │
    │      │                   │                   │                 │
    │      │                   │ Generate JWT      │                 │
    │      │                   │ {userId, role}    │                 │
    │      │                   │                   │                 │
    │      │◄──────────────────│                   │                 │
    │      │ {token, user}     │                   │                 │
    │      │                   │                   │                 │
    │      │ Store token       │                   │                 │
    │      │ (localStorage)    │                   │                 │
    │      │                   │                   │                 │
    └─────────────────────────────────────────────────────────────────┘

                         PROTECTED REQUEST
    ┌─────────────────────────────────────────────────────────────────┐
    │                                                                 │
    │  ┌────────┐         ┌─────────┐         ┌──────────┐          │
    │  │ Client │         │ Backend │         │ Database │          │
    │  └───┬────┘         └────┬────┘         └────┬─────┘          │
    │      │                   │                   │                 │
    │      │ GET /api/envs     │                   │                 │
    │      │ Authorization:    │                   │                 │
    │      │ Bearer <token>    │                   │                 │
    │      │──────────────────►│                   │                 │
    │      │                   │                   │                 │
    │      │                   │ Verify JWT        │                 │
    │      │                   │ signature         │                 │
    │      │                   │                   │                 │
    │      │                   │ Check expiry      │                 │
    │      │                   │                   │                 │
    │      │                   │ Extract userId    │                 │
    │      │                   │ & role            │                 │
    │      │                   │                   │                 │
    │      │                   │ RBAC check        │                 │
    │      │                   │                   │                 │
    │      │                   │ Query data        │                 │
    │      │                   │──────────────────►│                 │
    │      │                   │                   │                 │
    │      │                   │◄──────────────────│                 │
    │      │                   │                   │                 │
    │      │◄──────────────────│                   │                 │
    │      │ {environments}    │                   │                 │
    │      │                   │                   │                 │
    └─────────────────────────────────────────────────────────────────┘
```

---

## Technology Stack

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            TECHNOLOGY STACK                                      │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ FRONTEND                                                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │
│  │   Next.js    │  │    React     │  │  TypeScript  │  │     MUI      │        │
│  │    14.x      │  │    18.x      │  │     5.x      │  │    5.16      │        │
│  │              │  │              │  │              │  │  (Material)  │        │
│  │ • SSR/SSG    │  │ • Hooks      │  │ • Type Safe  │  │ • Components │        │
│  │ • App Router │  │ • Context    │  │ • Interfaces │  │ • Theming    │        │
│  │ • API Routes │  │ • State Mgmt │  │ • Generics   │  │ • Icons      │        │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘        │
│                                                                                  │
│  ┌──────────────┐  ┌──────────────┐                                             │
│  │ Tailwind CSS │  │    Axios     │                                             │
│  │     3.x      │  │    1.7.x     │                                             │
│  │              │  │              │                                             │
│  │ • Utility    │  │ • HTTP Client│                                             │
│  │ • Responsive │  │ • Interceptor│                                             │
│  └──────────────┘  └──────────────┘                                             │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ BACKEND                                                                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │
│  │   Node.js    │  │  Express.js  │  │     JWT      │  │    bcrypt    │        │
│  │    22.x      │  │    4.21      │  │  jsonwebtoken│  │    5.1.x     │        │
│  │              │  │              │  │              │  │              │        │
│  │ • Runtime    │  │ • Routing    │  │ • Auth Token │  │ • Password   │        │
│  │ • ES Modules │  │ • Middleware │  │ • Claims     │  │   Hashing    │        │
│  │ • Async/Await│  │ • REST API   │  │ • Expiry     │  │ • Salt       │        │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘        │
│                                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                          │
│  │      pg      │  │    Helmet    │  │     CORS     │                          │
│  │    8.13      │  │    8.0.x     │  │    2.8.x     │                          │
│  │              │  │              │  │              │                          │
│  │ • PostgreSQL │  │ • Security   │  │ • Cross-     │                          │
│  │   Client     │  │   Headers    │  │   Origin     │                          │
│  │ • Connection │  │ • CSP        │  │ • Preflight  │                          │
│  │   Pooling    │  │              │  │              │                          │
│  └──────────────┘  └──────────────┘  └──────────────┘                          │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ DATABASE                                                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────┐          │
│  │                      PostgreSQL 15                                │          │
│  │                                                                   │          │
│  │  • UUID primary keys for all entities                            │          │
│  │  • JSONB columns for flexible metadata                           │          │
│  │  • Timestamp columns (created_at, updated_at)                    │          │
│  │  • Foreign key constraints with cascading                        │          │
│  │  • Indexes on frequently queried columns                         │          │
│  │  • CHECK constraints for enums                                   │          │
│  │                                                                   │          │
│  └──────────────────────────────────────────────────────────────────┘          │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ DEVOPS                                                                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                          │
│  │    Docker    │  │   Docker     │  │     Git      │                          │
│  │              │  │   Compose    │  │              │                          │
│  │              │  │              │  │              │                          │
│  │ • Containers │  │ • Multi-     │  │ • Version    │                          │
│  │ • Images     │  │   Container  │  │   Control    │                          │
│  │ • Volumes    │  │ • Networks   │  │ • Branches   │                          │
│  └──────────────┘  └──────────────┘  └──────────────┘                          │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## Security Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           SECURITY LAYERS                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ Layer 0: REVERSE PROXY (Nginx)                                                   │
│ ┌─────────────────────────────────────────────────────────────────────────────┐ │
│ │  • SSL/TLS Termination (TLS 1.2/1.3 only)                                   │ │
│ │  • HTTP/2 enabled                                                           │ │
│ │  • Security Headers:                                                        │ │
│ │    - Content-Security-Policy (XSS/injection protection)                     │ │
│ │    - Strict-Transport-Security (HSTS with preload)                          │ │
│ │    - X-Frame-Options: SAMEORIGIN (clickjacking)                             │ │
│ │    - X-Content-Type-Options: nosniff                                        │ │
│ │    - Permissions-Policy (disabled geolocation, camera, etc.)                │ │
│ │  • HTTP → HTTPS redirect                                                    │ │
│ └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│ Layer 1: NETWORK SECURITY                                                        │
│ ┌─────────────────────────────────────────────────────────────────────────────┐ │
│ │  • Docker network isolation (tem-network)                                   │ │
│ │  • Database NOT exposed externally (internal network only)                  │ │
│ │  • CORS policy - explicit allowed origins                                   │ │
│ │  • Rate limiting:                                                           │ │
│ │    - General: 100 requests per 15 minutes                                   │ │
│ │    - Auth endpoints: 5 requests per 15 minutes                              │ │
│ │  • Request body size limit: 10KB                                            │ │
│ └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│ Layer 2: APPLICATION SECURITY                                                    │
│ ┌─────────────────────────────────────────────────────────────────────────────┐ │
│ │  • Helmet.js security headers                                               │ │
│ │  • express-validator input validation & sanitization                        │ │
│ │  • SQL injection prevention (parameterized queries)                         │ │
│ │  • XSS protection via CSP                                                   │ │
│ │  • Error messages don't expose internal details                             │ │
│ └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│ Layer 3: AUTHENTICATION                                                          │
│ ┌─────────────────────────────────────────────────────────────────────────────┐ │
│ │  • JWT tokens (configurable expiry, default 24h)                            │ │
│ │  • bcrypt password hashing (12 rounds - OWASP recommended)                  │ │
│ │  • Password strength requirements:                                          │ │
│ │    - Minimum 8 characters                                                   │ │
│ │    - Uppercase, lowercase, number, special character                        │ │
│ │  • JWT secret via environment variable (required)                           │ │
│ │  • SSO integration ready (OIDC/SAML)                                        │ │
│ └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│ Layer 4: AUTHORIZATION (RBAC)                                                    │
│ ┌─────────────────────────────────────────────────────────────────────────────┐ │
│ │  • Role-based access control                                                │ │
│ │  • Resource-level permissions                                               │ │
│ │  • Group-based access                                                       │ │
│ │  • Registration forced to 'Tester' role (no role injection)                 │ │
│ │                                                                             │ │
│ │  ┌─────────────────────────────────────────────────────────────────────┐   │ │
│ │  │ Role          │ Create │ Read │ Update │ Delete │ Approve │ Admin  │   │ │
│ │  ├───────────────┼────────┼──────┼────────┼────────┼─────────┼────────┤   │ │
│ │  │ Admin         │   ✓    │  ✓   │   ✓    │   ✓    │    ✓    │   ✓    │   │ │
│ │  │ EnvManager    │   ✓    │  ✓   │   ✓    │   ✓    │    ✓    │   ✗    │   │ │
│ │  │ ProjectLead   │   ✓    │  ✓   │   ✓    │   ✗    │    ✗    │   ✗    │   │ │
│ │  │ Tester        │   ✓*   │  ✓   │   ✗    │   ✗    │    ✗    │   ✗    │   │ │
│ │  │ Viewer        │   ✗    │  ✓   │   ✗    │   ✗    │    ✗    │   ✗    │   │ │
│ │  └─────────────────────────────────────────────────────────────────────┘   │ │
│ │  * Tester can create bookings only                                         │ │
│ └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│ Layer 5: DATA SECURITY                                                           │
│ ┌─────────────────────────────────────────────────────────────────────────────┐ │
│ │  • Encrypted passwords (bcrypt, never stored in plain text)                 │ │
│ │  • Prepared statements (prevent SQL injection)                              │ │
│ │  • Audit logging (activity_log table)                                       │ │
│ │  • Data sensitivity classification                                          │ │
│ │  • Credentials via environment variables (not in code)                      │ │
│ └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## Deployment Options

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          DEPLOYMENT OPTIONS                                      │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ OPTION 1: Docker Compose (Development/Small Teams)                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────┐                   │
│  │                   Single Host                            │                   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐           │                   │
│  │  │ Frontend  │  │  Backend  │  │ PostgreSQL│           │                   │
│  │  │ Container │  │ Container │  │ Container │           │                   │
│  │  └───────────┘  └───────────┘  └───────────┘           │                   │
│  └─────────────────────────────────────────────────────────┘                   │
│                                                                                  │
│  Pros: Simple setup, good for development                                       │
│  Cons: Single point of failure, limited scalability                             │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ OPTION 2: Cloud Platform (Production)                                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         Cloud Provider                                   │   │
│  │                                                                          │   │
│  │  ┌─────────────┐      ┌─────────────┐      ┌─────────────┐             │   │
│  │  │   Vercel    │      │  Railway/   │      │  Managed    │             │   │
│  │  │   or CDN    │      │  Render     │      │  PostgreSQL │             │   │
│  │  │             │      │             │      │             │             │   │
│  │  │  Frontend   │─────►│   Backend   │─────►│  Database   │             │   │
│  │  │             │      │             │      │  (RDS/Cloud │             │   │
│  │  │             │      │             │      │   SQL)      │             │   │
│  │  └─────────────┘      └─────────────┘      └─────────────┘             │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│  Pros: Scalable, managed services, high availability                            │
│  Cons: Higher cost, vendor lock-in                                              │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ OPTION 3: Kubernetes (Enterprise)                                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      Kubernetes Cluster                                  │   │
│  │                                                                          │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │ Ingress Controller (nginx/traefik)                               │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                            │                                            │   │
│  │            ┌───────────────┼───────────────┐                           │   │
│  │            ▼               ▼               ▼                           │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                   │   │
│  │  │  Frontend   │  │  Frontend   │  │  Frontend   │                   │   │
│  │  │   Pod 1     │  │   Pod 2     │  │   Pod 3     │                   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                   │   │
│  │                                                                          │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                   │   │
│  │  │  Backend    │  │  Backend    │  │  Backend    │                   │   │
│  │  │   Pod 1     │  │   Pod 2     │  │   Pod 3     │                   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                   │   │
│  │                            │                                            │   │
│  │                            ▼                                            │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │ PostgreSQL StatefulSet (with PVC)                                │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│  Pros: Highly scalable, self-healing, enterprise features                       │
│  Cons: Complex setup, requires K8s expertise                                    │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## Environment Variables

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        ENVIRONMENT VARIABLES                                     │
└─────────────────────────────────────────────────────────────────────────────────┘

BACKEND (.env)
┌─────────────────────────────────────────────────────────────────────────────────┐
│ # Server                                                                         │
│ NODE_ENV=production                                                              │
│ PORT=5000                                                                        │
│                                                                                  │
│ # Database (Option A: Connection String)                                         │
│ DATABASE_URL=postgresql://user:password@host:5432/dbname                        │
│                                                                                  │
│ # Database (Option B: Individual Variables)                                      │
│ DB_HOST=localhost                                                                │
│ DB_PORT=5432                                                                     │
│ DB_NAME=tem_db                                                                   │
│ DB_USER=tem_user                                                                 │
│ DB_PASSWORD=your_secure_password                                                 │
│                                                                                  │
│ # Authentication                                                                 │
│ JWT_SECRET=your-very-long-random-secret-key-min-32-chars                        │
│ JWT_EXPIRES_IN=24h                                                               │
│                                                                                  │
│ # CORS                                                                           │
│ CORS_ORIGIN=https://your-frontend-domain.com                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

FRONTEND (.env.local)
┌─────────────────────────────────────────────────────────────────────────────────┐
│ NEXT_PUBLIC_API_URL=https://your-backend-domain.com/api                         │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## File Structure

```
BookMyEnv/
├── docker-compose.yml          # Container orchestration
├── start.ps1                   # Windows startup script
├── README.md                   # Project overview
│
├── docs/
│   ├── ARCHITECTURE.md         # This file
│   ├── USER_GUIDE.md           # User documentation
│   └── QUICK_REFERENCE.md      # Quick reference card
│
├── backend/
│   ├── Dockerfile              # Backend container config
│   ├── package.json            # Node.js dependencies
│   │
│   ├── database/
│   │   └── init.sql            # Database schema & seed data
│   │
│   └── src/
│       ├── server.js           # Application entry point
│       │
│       ├── config/
│       │   └── database.js     # PostgreSQL connection
│       │
│       ├── middleware/
│       │   ├── auth.js         # JWT authentication
│       │   └── rbac.js         # Role-based access control
│       │
│       ├── routes/
│       │   ├── authRoutes.js
│       │   ├── environmentRoutes.js
│       │   ├── bookingRoutes.js
│       │   ├── releaseRoutes.js
│       │   ├── applicationRoutes.js
│       │   ├── groupRoutes.js
│       │   ├── userRoutes.js
│       │   ├── integrationRoutes.js
│       │   └── changeRoutes.js
│       │
│       └── controllers/
│           ├── authController.js
│           ├── environmentController.js
│           ├── bookingController.js
│           ├── releaseController.js
│           ├── applicationController.js
│           ├── groupController.js
│           ├── userController.js
│           ├── integrationController.js
│           └── changeController.js
│
└── frontend/
    ├── Dockerfile              # Frontend container config
    ├── package.json            # Node.js dependencies
    ├── next.config.js          # Next.js configuration
    ├── tailwind.config.js      # Tailwind CSS config
    ├── tsconfig.json           # TypeScript config
    │
    ├── public/                 # Static assets
    │
    └── src/
        ├── app/
        │   ├── globals.css     # Global styles
        │   ├── layout.tsx      # Root layout
        │   ├── page.tsx        # Landing page (redirect)
        │   │
        │   ├── login/
        │   │   └── page.tsx    # Login page
        │   │
        │   └── (dashboard)/
        │       ├── layout.tsx  # Dashboard layout with sidebar
        │       ├── dashboard/page.tsx
        │       ├── environments/page.tsx
        │       ├── bookings/page.tsx
        │       ├── releases/page.tsx
        │       ├── applications/page.tsx
        │       ├── groups/page.tsx
        │       ├── monitoring/page.tsx
        │       ├── integrations/page.tsx
        │       ├── topology/page.tsx
        │       ├── testdata/page.tsx
        │       ├── interfaces/page.tsx
        │       ├── configs/page.tsx
        │       └── settings/page.tsx
        │
        ├── contexts/
        │   └── AuthContext.tsx # Authentication state
        │
        └── lib/
            ├── api.ts          # Axios API client
            └── socket.ts       # WebSocket client
```

---

## Feature Summary

### Core Features

| Feature | Description |
|---------|-------------|
| **Environment Management** | Create environments with multiple instances, track operational status |
| **Application Deployments** | Deploy/undeploy apps to instances, track versions and models |
| **Booking System** | Reserve environments, detect conflicts, calendar view |
| **Conflict Resolution** | View and resolve booking conflicts with multiple resolution types |
| **Release Management** | Plan releases with app/env associations, track status |
| **Bulk Data Upload** | Import environments, instances, apps, interfaces, components via CSV |
| **Topology View** | Visual representation of environment-app relationships |
| **Real-time Dashboard** | Live stats, activity feed, availability metrics |

### Security Features

| Feature | Description |
|---------|-------------|
| **JWT Authentication** | Secure token-based auth with configurable expiry |
| **Role-Based Access** | 5 roles: Admin, EnvironmentManager, ProjectLead, Tester, Viewer |
| **HTTPS/TLS** | TLS 1.2/1.3 via Nginx reverse proxy |
| **Rate Limiting** | Configurable request limits (currently disabled for dev) |
| **Security Headers** | CSP, HSTS, X-Frame-Options, X-Content-Type-Options |
| **Password Security** | bcrypt with 12 rounds, policy enforcement |

### Integration Features

| Integration | Capabilities |
|-------------|--------------|
| **Jira** | Link issues, sync status, auto-create for conflicts |
| **GitLab** | Link pipelines/MRs, trigger deployments, track status |
| **ServiceNow** | Change tickets, CMDB sync, approval workflows |

---

## Version History

| Version | Date | Key Changes |
|---------|------|-------------|
| 2.1.0 | Dec 2025 | Application deployments management, deploy/undeploy UI |
| 2.0.0 | Dec 2025 | Conflict detection & resolution, bulk data upload |
| 1.0.0 | Nov 2025 | Initial release |

---

**© 2025 BookMyEnv. All rights reserved.**
